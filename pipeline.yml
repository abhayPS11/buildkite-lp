steps:
  - label: "Checkout code"
    command: "echo 'Code checkout done'"
    agents:
      queue: "amd-buildkite"

  - label: "Build & push multi-arch Docker image"
    commands:
      - docker buildx create --use
      - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"      
      - docker buildx build --platform linux/amd64,linux/arm64 -t "$DOCKER_USERNAME/test-x86:latest" --push .
    agents:
      queue: "amd-buildkite"
